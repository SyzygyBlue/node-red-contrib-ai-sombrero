<!-- MCP Node Registration -->
<script type="text/javascript">
    RED.nodes.registerType('mcp-node', {
        category: 'Sombrero-AI',
        color: '#a6bbcf',
        icon: 'font-awesome/fa-cogs',
        label: function() {
            return this.name || 'MCP Node';
        },
        defaults: {
            name: { value: "" },
            routingMode: { value: "rule" },
            rules: { value: [] },
            aiPromptTemplate: { value: "" },
            outputLabels: { value: [] },
            debugMode: { value: false },
            llmConfig: { value: "", type: "llm-config", required: true },
            dbConfig: { value: "", type: "dbconfig-node", required: false }
        },
        inputs: 1,
        outputs: 0,

        oneditprepare: function() {
            // Load external editor scripts
            $.getScript('mcp-node/lib/ui/scripts/editor.js');

            // Initialize LLM & DB config dropdowns
            RED.nodes.config.init({
                id: 'node-input-llmConfig',
                type: 'llm-config',
                required: true
            });
            RED.nodes.config.init({
                id: 'node-input-dbConfig',
                type: 'dbconfig-node',
                required: false
            });
        }
    });
</script>

<!-- MCP Node Editor Template -->
<script type="text/html" data-template-name="mcp-node">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-llmConfig"><i class="fa fa-hat-cowboy"></i> LLM Config</label>
        <input type="text" id="node-input-llmConfig" placeholder="Select LLM Configuration">
    </div>
    <div class="form-row">
        <label for="node-input-dbConfig"><i class="fa fa-database"></i> Database Config</label>
        <input type="text" id="node-input-dbConfig" placeholder="Select Database Configuration">
    </div>

    <!-- Placeholder for new sub-screen triggers -->
    <div class="form-row">
        <button type="button" id="node-input-edit-rules">Edit Rules</button>
        <button type="button" id="node-input-edit-ai">Edit AI Settings</button>
    </div>

</script>

<!-- MCP Node Help -->
<script type="text/html" data-help-name="mcp-node">
    <p>A node that provides dynamic routing capabilities with both AI-powered and rule-based decision making.</p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">any</span>
        </dt>
        <dd>The message payload to be routed.</dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>outputs
            <span class="property-type">multiple</span>
        </dt>
        <dd>Messages are routed to one or more outputs based on rules or AI decisions.</dd>
    </dl>

    <h3>Details</h3>
    <p>The MCP (Multi-Component Processing) node allows you to route messages to different outputs based on:</p>
    <ul>
        <li><b>Rule-based routing:</b> Define rules with conditions to route messages</li>
        <li><b>AI-powered routing:</b> Use LLM to analyze message content and decide routing</li>
        <li><b>Hybrid routing:</b> Combine rules and AI for sophisticated routing logic</li>
    </ul>

    <p>The node supports dynamic output configuration, fallback mechanisms, and comprehensive debugging.</p>
</script>

